/*global MutationObserver, CSSRule */
/**
 * @fileOverview This file contains the /components/ module for emulating Web Components behavior.
 * @name components.js<src>
 * @author Etienne Prud’homme
 * @version 1.0.0
 * @link https://github.com/notetiene/components
 * @todo Keep track of instances. This way, the style tag could be removed.
 * @license MIT
 */
var components=function(){function e(e,t){var n;for(n in t)t.hasOwnProperty(n)&&void 0===e[n]&&(e[n]=t[n])}function t(e){var t=document.implementation.createHTMLDocument(""),n=document.createElement("style");return n.textContent=e.replace(/\$self/g,".components-lib-self-component"),t.body.appendChild(n),n.sheet.cssRules}function n(e,t){var o,r,l=0,a=null,i="";for(r=t&&""!==t?t+" ":"",o=e.length;l<o;l++)if(a=e[l],a.type!==CSSRule.MEDIA_RULE){if(a.type!==CSSRule.STYLE_RULE)throw new Error("Only style rules and media rules are currently supported for style scoping");i+=".components-lib-self-component"!==a.selectorText.trim()?r+a.cssText:a.cssText.replace(/\.components-lib-self-component/g,t)}else i+=" @media "+a.media.mediaText+" { ",i+=n(a.cssRules,t),i+=" }";return i}function o(e,o){var r=t(e),l=o.className,a="";if(l.length<10)throw new Error("“topNode” doesn’t contain classes to act asselector or is too short & risk to have collisions");return l="."+l.replace(/ /g,"."),a=n(r,l)}function r(e,t,n,r,l){var a=e+"-components-lib-style",i=document.getElementById(a),c=t||null,s=null,d=null,p=e+"-components-lib-scoped";return null!==i||"[object String]"!==Object.prototype.toString.apply(c)?r:(s=document.createElement("style"),s.id=a,d=document.createElement("div"),d.className=p,r.style&&(d.style.display=r.style.display),d.appendChild(r),r=d,n.appendChild(d),s.textContent=o(t,d),l&&""!==l&&(s.textContent+=o(l,d)),document.head.appendChild(s),r)}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});var l={},a=document.createRange();a.selectNode(document.body);var i=function(e,t,n){if(e.constructor!==String||""===e)throw new Error("Cannot register the component. The name must be a String.");if(t.constructor!==String||""===t)throw new Error("Cannot register "+e+" component. The template must be a String.");if(void 0!==l[e]&&l.hasOwnProperty(e))throw new Error(e+" is an already registered component.");var o=n||{};Object.defineProperty(l,e,{enumerable:!1,configurable:!1,writable:!1,value:{template:t,proto:o}})},c=function(t,n){if(!l.hasOwnProperty(t))throw new Error("“"+t+"” is not a registered component");for(var o=l[t],i=n||"",c=o.proto.style||void 0,s=a.createContextualFragment(o.template),d=null,p=0,u=s.childNodes.length;p<u;p++)if(s.childNodes[p].nodeType===Node.ELEMENT_NODE||s.childNodes[p].nodeType===Node.DOCUMENT_FRAGMENT_NODE){d=s.childNodes[p];break}if(null===d)throw new Error("The “"+t+"” component doesn’t contain a valid node.");d=r(t,c,s,d,i);var m=o.proto.createdCallback||{};m instanceof Function&&m.call(d);var f=o.proto.attachedCallback;if(f instanceof Function){var h=new MutationObserver(function(t){for(var n=0,o=t.length;n<o;n++)"childList"===t[n].type&&t[n].removedNodes[0]===d&&(e(d,s),f.call(d))});h.observe(s,{childList:!0})}var y=o.proto.attributeChangedCallback;if(y instanceof Function){var v=new MutationObserver(function(e){for(var t=0,n=e.length;t<n;t++)"attributes"===e[t].type&&y.call(d)});v.observe(d,{attributes:!0})}return d};return{registerElement:i,createElement:c}}();